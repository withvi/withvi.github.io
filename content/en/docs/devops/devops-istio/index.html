
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Hack and Secure Kubernetes with Vĩ">
      
      
        <meta name="author" content="Nhâm Chấn Vĩ">
      
      
        <link rel="canonical" href="https://hack8s.withvi.com/content/en/docs/devops/devops-istio/">
      
      <link rel="icon" href="../../../../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.16">
    
    
      
        <title>Istio Service Mesh - w/vi</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.1c3799f8.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#istio-service-mesh" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../../../../.."> 
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="w/vi" class="md-header__button md-logo" aria-label="w/vi" data-md-component="logo">
      
  <img src="../../../../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            w/vi
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Istio Service Mesh
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../kubernetes/pentesting-kubernetes-services.md" class="md-tabs__link">
        Hack
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="/Users/vi/DevSecOps/withvi.github.io/docs/content/en/docs/secure/secure-kubernetes.md" class="md-tabs__link">
        Secure
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="/Users/vi/DevSecOps/withvi.github.io/docs/content/en/docs/devops/devops-kubernetes.md" class="md-tabs__link">
        DevOps
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="w/vi" class="md-nav__button md-logo" aria-label="w/vi" data-md-component="logo">
      
  <img src="../../../../../images/logo.png" alt="logo">

    </a>
    w/vi
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1">
          Hack
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hack" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Hack
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1" type="checkbox" id="__nav_1_1" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_1">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kubernetes" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_1">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/pentesting-kubernetes-services.md" class="md-nav__link">
        Pentesting Kubernetes Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/exposing-services-in-kubernetes.md" class="md-nav__link">
        Exposing Services in Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/attacking-kubernetes-from-inside-a-pod.md" class="md-nav__link">
        Attacking Kubernetes from inside a Pod
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/kubernetes-enumeration.md" class="md-nav__link">
        Kubernetes Enumeration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/kubernetes-role-based-access-control.md" class="md-nav__link">
        Kubernetes Role-Based Access Control (RBAC)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/abusing-roles-clusterroles-in-kubernetes.md" class="md-nav__link">
        Abusing Roles/ClusterRoles in Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/kubernetes-namespace-escalation.md" class="md-nav__link">
        Kubernetes Namespace Escalation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/kubernetes-access-to-other-clouds.md" class="md-nav__link">
        Kubernetes Access to other Clouds
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/kubernetes-network-attacks.md" class="md-nav__link">
        Kubernetes Network Attacks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linux" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/checklist-linux-privilege-escalation.md" class="md-nav__link">
        Checklist - Linux Privilege Escalation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_2" type="checkbox" id="__nav_1_2_2" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_2">
          Linux Privilege Escalation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linux Privilege Escalation" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_2_2">
          <span class="md-nav__icon md-icon"></span>
          Linux Privilege Escalation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_2_1" type="checkbox" id="__nav_1_2_2_1" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_2_1">
          Docker Basics & Breakout
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Docker Basics & Breakout" data-md-level="4">
        <label class="md-nav__title" for="__nav_1_2_2_1">
          <span class="md-nav__icon md-icon"></span>
          Docker Basics & Breakout
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/docker/authz-authn-docker-access-authorization-plugin.md" class="md-nav__link">
        AuthZ & AuthN - Docker Access Authorization Plugin
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_2_1_2" type="checkbox" id="__nav_1_2_2_1_2" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_2_1_2">
          Docker Breakout / Privilege Escalation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Docker Breakout / Privilege Escalation" data-md-level="5">
        <label class="md-nav__title" for="__nav_1_2_2_1_2">
          <span class="md-nav__icon md-icon"></span>
          Docker Breakout / Privilege Escalation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/docker/release_agent-exploit-relative-paths-to-pids.md" class="md-nav__link">
        release_agent exploit - Relative Paths to PIDs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/docker/docker-release_agent-cgroups-escape.md" class="md-nav__link">
        Docker release_agent cgroups escape
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/docker/sensitive-mounts.md" class="md-nav__link">
        Sensitive Mounts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/docker/seccomp.md" class="md-nav__link">
        Seccomp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/docker/apparmor.md" class="md-nav__link">
        AppArmor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/docker/namespaces.md" class="md-nav__link">
        Namespaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/docker/docker--privileged.md" class="md-nav__link">
        Docker --privileged
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/docker/abusing-docker-socket-for-privilege-escalation.md" class="md-nav__link">
        Abusing Docker Socket for Privilege Escalation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/linux-capabilities.md" class="md-nav__link">
        Linux Capabilities
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/useful-linux-commands.md" class="md-nav__link">
        Useful Linux Commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_4" type="checkbox" id="__nav_1_2_4" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_2_4">
          Bypass Linux Shell Restrictions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Bypass Linux Shell Restrictions" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_2_4">
          <span class="md-nav__icon md-icon"></span>
          Bypass Linux Shell Restrictions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/ddexec.md" class="md-nav__link">
        DDexec
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/linux-environment-variables.md" class="md-nav__link">
        Linux Environment Variables
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_3">
          Pentesting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pentesting" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Pentesting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3_1" type="checkbox" id="__nav_1_3_1" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_3_1">
          Network Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Network Services" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_3_1">
          <span class="md-nav__icon md-icon"></span>
          Network Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pentesting/network/44134-pentesting-tiller-helm.md" class="md-nav__link">
        44134 Pentesting Tiller (Helm)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Secure
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Secure" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Secure
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/Users/vi/DevSecOps/withvi.github.io/docs/content/en/docs/secure/secure-kubernetes.md" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/Users/vi/DevSecOps/withvi.github.io/docs/content/en/docs/secure/secure-github.md" class="md-nav__link">
        Github
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/Users/vi/DevSecOps/withvi.github.io/docs/content/en/docs/secure/secure-circleci.md" class="md-nav__link">
        CircleCI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/Users/vi/DevSecOps/withvi.github.io/docs/content/en/docs/secure/secure-jenkins.md" class="md-nav__link">
        Jenkins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/Users/vi/DevSecOps/withvi.github.io/docs/content/en/docs/secure/secure-aws.md" class="md-nav__link">
        AWS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          DevOps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DevOps" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          DevOps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/Users/vi/DevSecOps/withvi.github.io/docs/content/en/docs/devops/devops-kubernetes.md" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/Users/vi/DevSecOps/withvi.github.io/docs/content/en/docs/devops/devops-istio.md" class="md-nav__link">
        Istio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/Users/vi/DevSecOps/withvi.github.io/docs/content/en/docs/devops/devops-bitbucket.md" class="md-nav__link">
        Bitbucket
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  
  


  <nav class="md-tags" hidden>
    
      
        <a href="../../../../../tags/#monoliths" class="md-tag">
          monoliths
        </a>
      
    
      
        <a href="../../../../../tags/#microservices" class="md-tag">
          microservices
        </a>
      
    
      
        <a href="../../../../../tags/#service-mesh" class="md-tag">
          service mesh
        </a>
      
    
  </nav>



<h1 id="istio-service-mesh">Istio Service Mesh<a class="headerlink" href="#istio-service-mesh" title="Permanent link">&para;</a></h1>
<!-- set the topic's context with a single paragraph. -->

<p>Service Mesh introduction</p>
<h2 id="istio-introduction">Istio Introduction<a class="headerlink" href="#istio-introduction" title="Permanent link">&para;</a></h2>
<h3 id="monoliths-vs-microservices">Monoliths vs Microservices<a class="headerlink" href="#monoliths-vs-microservices" title="Permanent link">&para;</a></h3>
<h4 id="pros-of-microservices">Pros of Microservices<a class="headerlink" href="#pros-of-microservices" title="Permanent link">&para;</a></h4>
<ul>
<li>Scalability.</li>
<li>Faster, smaller releases, and less risky.</li>
<li>Technology and language agnostic Development lifecycle.</li>
<li>System resiliency and isolation.</li>
<li>Independent and easy to understand services.</li>
</ul>
<h4 id="cons-of-microservices">Cons of Microservices<a class="headerlink" href="#cons-of-microservices" title="Permanent link">&para;</a></h4>
<ul>
<li>Complex Service Networking</li>
<li>Security</li>
<li>Observability</li>
<li>
<p>Overload for Traditional Operation Models</p>
</li>
<li>
<p>Single proxy in the form of a sidecar container to replace all the different requirements into each microservice. The proxies communicate with each other through what is known as a data plane and they communicate to a server site component called control plane.</p>
</li>
<li>Control plane manages all the traffic into and out of your services via proxies, so all the networking logic is abstracted from your business code. This approach is known as a Service Mesh.</li>
</ul>
<h3 id="service-mesh">Service Mesh<a class="headerlink" href="#service-mesh" title="Permanent link">&para;</a></h3>
<h4 id="what-is-service-mesh">What is Service Mesh?<a class="headerlink" href="#what-is-service-mesh" title="Permanent link">&para;</a></h4>
<p>Service Mesh is a dedicated and configurable infrastructure layer that handles the communication between services without having to change the code in a microservice architecture.</p>
<h4 id="what-is-service-mesh-responsible-for">What is Service Mesh Responsible For?<a class="headerlink" href="#what-is-service-mesh-responsible-for" title="Permanent link">&para;</a></h4>
<ul>
<li>With the Service Mesh, you can dynamically configure how services talk to each other.</li>
<li>When services talk to one another, you'll have mutual TLS, so your workloads can be secure. You can see thing better. For example, how the application is doing end-to-end, where it is having issues and bottlenecks, and service discovery which covers three main topics:</li>
<li>Discovery - you need to know at which IP and port services are exposed so they can find each other.</li>
<li>Health Check - helps you dynamically keep services that are up in the mesh while services that are down are left out.</li>
<li>Load Balancing - routes the traffic to healthy instances and cuts it off from the ones who have been failing.</li>
</ul>
<h3 id="istio">Istio<a class="headerlink" href="#istio" title="Permanent link">&para;</a></h3>
<ul>
<li>Istio is a free and open-source service mesh that provides an efficient way to secure, connect, and monitor services. Istio works with Kubernetes and traditional workloads, thereby bringing universal traffic management, telemetry and security to complex deployments.</li>
<li>Istio is supported and implemented by leading cloud providers and consultants.</li>
<li>Proxy service that takes care of all the tasks that should be outsourced from the microservice. These proxies and the communication between them form the data plane.</li>
<li>Istio implements these proxies using an open-source, high-performance proxy known as Envoy.</li>
<li>The proxies talk to a server side component known as the control plan.</li>
<li>Originally, the control plane consisted of three components named Citadel, Pilot, and Galley.</li>
<li>Citadel managed certificate generation.</li>
<li>Pilot helped with service discovery.</li>
<li>Galley helped in validating configuration file.</li>
<li>The three components were later combined into a single daemon called Istiod. Each service or pod has a separate component in it along with the Envoy proxy called the Istio Agent.</li>
<li>Istio Agent is responsible for passing configuration secrets to the Envoy proxies.</li>
</ul>
<h3 id="installing-istioctl">Installing Istioctl<a class="headerlink" href="#installing-istioctl" title="Permanent link">&para;</a></h3>
<p>Download the Istio latest binary and install it</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>curl -L https://istio.io/downloadIstio <span class="p">|</span> sh -
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>                                 Dload  Upload   Total   Spent    Left  Speed
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="m">100</span>   <span class="m">101</span>  <span class="m">100</span>   <span class="m">101</span>    <span class="m">0</span>     <span class="m">0</span>    <span class="m">136</span>      <span class="m">0</span> --:--:-- --:--:-- --:--:--   <span class="m">137</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="m">100</span>  <span class="m">4926</span>  <span class="m">100</span>  <span class="m">4926</span>    <span class="m">0</span>     <span class="m">0</span>   <span class="m">4070</span>      <span class="m">0</span>  <span class="m">0</span>:00:01  <span class="m">0</span>:00:01 --:--:--  <span class="m">4070</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>Downloading istio-1.14.1 from https://github.com/istio/istio/releases/download/1.14.1/istio-1.14.1-osx.tar.gz ...
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>Istio <span class="m">1</span>.14.1 Download Complete!
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>Istio has been successfully downloaded into the istio-1.14.1 folder on your system.
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>Next Steps:
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>See https://istio.io/latest/docs/setup/install/ to add Istio to your Kubernetes cluster.
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>To configure the istioctl client tool <span class="k">for</span> your workstation,
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>add the /Users/vi/DevSecOps/demo/istio/istio-1.14.1/bin directory to your environment path variable with:
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>         <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PATH</span><span class="s2">:/Users/vi/DevSecOps/demo/istio/istio-1.14.1/bin&quot;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>Begin the Istio pre-installation check by running:
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>         istioctl x precheck
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>Need more information? Visit https://istio.io/latest/docs/setup/install/
</code></pre></div>
<p>Move to the Istio directory, this directory is also named with the Istio version you downloaded</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">cd</span> istio-1.14.1
</code></pre></div>
<p>Add the istioctl client to our path</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PWD</span>/bin:<span class="nv">$PATH</span>
</code></pre></div>
<p>Check if istioctl is installed</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>istioctl version
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>no running Istio pods <span class="k">in</span> <span class="s2">&quot;istio-system&quot;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="m">1</span>.14.1
</code></pre></div>
<p>Check if our cluster has Istio installed</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>istioctl verify-install
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="m">0</span> Istio control planes detected, checking --revision <span class="s2">&quot;default&quot;</span> only
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>error <span class="k">while</span> fetching revision : the server could not find the requested resource
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="m">0</span> Istio injectors detected
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>Error: could not load IstioOperator from cluster: the server could not find the requested resource. Use --filename
</code></pre></div>
<h3 id="installing-istio-on-your-cluster">Installing Istio on your cluster<a class="headerlink" href="#installing-istio-on-your-cluster" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>There are 3 different approaches to install Istio on cluster</p>
</li>
<li>
<p>Install with Istioctl</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>istioctl install --set <span class="nv">profile</span><span class="o">=</span>demo -y
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>✔ Istio core installed
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>✔ Istiod installed
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>✔ Egress gateways installed
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>✔ Ingress gateways installed
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>✔ Installation <span class="nb">complete</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>Making this installation the default <span class="k">for</span> injection and validation.
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>Thank you <span class="k">for</span> installing Istio <span class="m">1</span>.14.  Please take a few minutes to tell us about your install/upgrade experience!  https://forms.gle/yEtCbt45FZ3VoDT5A
</code></pre></div>
<p>Check if our cluster has Istio installed</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>istioctl verify-install
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="m">1</span> Istio control planes detected, checking --revision <span class="s2">&quot;default&quot;</span> only
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>✔ Deployment: istio-egressgateway.istio-system checked successfully
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>✔ PodDisruptionBudget: istio-egressgateway.istio-system checked successfully
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>✔ Role: istio-egressgateway-sds.istio-system checked successfully
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>✔ RoleBinding: istio-egressgateway-sds.istio-system checked successfully
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>✔ Service: istio-egressgateway.istio-system checked successfully
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>✔ ServiceAccount: istio-egressgateway-service-account.istio-system checked successfully
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>✔ ClusterRole: istiod-istio-system.istio-system checked successfully
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>✔ ClusterRole: istio-reader-istio-system.istio-system checked successfully
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>✔ ClusterRoleBinding: istio-reader-istio-system.istio-system checked successfully
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>✔ ClusterRoleBinding: istiod-istio-system.istio-system checked successfully
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>✔ ServiceAccount: istio-reader-service-account.istio-system checked successfully
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>✔ Role: istiod-istio-system.istio-system checked successfully
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>✔ RoleBinding: istiod-istio-system.istio-system checked successfully
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>✔ ServiceAccount: istiod-service-account.istio-system checked successfully
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>✔ CustomResourceDefinition: wasmplugins.extensions.istio.io.istio-system checked successfully
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>✔ CustomResourceDefinition: destinationrules.networking.istio.io.istio-system checked successfully
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>✔ CustomResourceDefinition: envoyfilters.networking.istio.io.istio-system checked successfully
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>✔ CustomResourceDefinition: gateways.networking.istio.io.istio-system checked successfully
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>✔ CustomResourceDefinition: proxyconfigs.networking.istio.io.istio-system checked successfully
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>✔ CustomResourceDefinition: serviceentries.networking.istio.io.istio-system checked successfully
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>✔ CustomResourceDefinition: sidecars.networking.istio.io.istio-system checked successfully
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>✔ CustomResourceDefinition: virtualservices.networking.istio.io.istio-system checked successfully
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>✔ CustomResourceDefinition: workloadentries.networking.istio.io.istio-system checked successfully
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>✔ CustomResourceDefinition: workloadgroups.networking.istio.io.istio-system checked successfully
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>✔ CustomResourceDefinition: authorizationpolicies.security.istio.io.istio-system checked successfully
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>✔ CustomResourceDefinition: peerauthentications.security.istio.io.istio-system checked successfully
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>✔ CustomResourceDefinition: requestauthentications.security.istio.io.istio-system checked successfully
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>✔ CustomResourceDefinition: telemetries.telemetry.istio.io.istio-system checked successfully
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>✔ CustomResourceDefinition: istiooperators.install.istio.io.istio-system checked successfully
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>✔ ClusterRole: istiod-clusterrole-istio-system.istio-system checked successfully
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>✔ ClusterRole: istiod-gateway-controller-istio-system.istio-system checked successfully
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>✔ ClusterRoleBinding: istiod-clusterrole-istio-system.istio-system checked successfully
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>✔ ClusterRoleBinding: istiod-gateway-controller-istio-system.istio-system checked successfully
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>✔ ConfigMap: istio.istio-system checked successfully
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>✔ Deployment: istiod.istio-system checked successfully
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>✔ ConfigMap: istio-sidecar-injector.istio-system checked successfully
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>✔ MutatingWebhookConfiguration: istio-sidecar-injector.istio-system checked successfully
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>✔ PodDisruptionBudget: istiod.istio-system checked successfully
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a>✔ ClusterRole: istio-reader-clusterrole-istio-system.istio-system checked successfully
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>✔ ClusterRoleBinding: istio-reader-clusterrole-istio-system.istio-system checked successfully
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>✔ Role: istiod.istio-system checked successfully
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>✔ RoleBinding: istiod.istio-system checked successfully
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a>✔ Service: istiod.istio-system checked successfully
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a>✔ ServiceAccount: istiod.istio-system checked successfully
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a>✔ EnvoyFilter: stats-filter-1.11.istio-system checked successfully
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a>✔ EnvoyFilter: tcp-stats-filter-1.11.istio-system checked successfully
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a>✔ EnvoyFilter: stats-filter-1.12.istio-system checked successfully
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a>✔ EnvoyFilter: tcp-stats-filter-1.12.istio-system checked successfully
<a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a>✔ EnvoyFilter: stats-filter-1.13.istio-system checked successfully
<a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a>✔ EnvoyFilter: tcp-stats-filter-1.13.istio-system checked successfully
<a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a>✔ EnvoyFilter: stats-filter-1.14.istio-system checked successfully
<a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a>✔ EnvoyFilter: tcp-stats-filter-1.14.istio-system checked successfully
<a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a>✔ EnvoyFilter: stats-filter-1.15.istio-system checked successfully
<a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a>✔ EnvoyFilter: tcp-stats-filter-1.15.istio-system checked successfully
<a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a>✔ ValidatingWebhookConfiguration: istio-validator-istio-system.istio-system checked successfully
<a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a>✔ Deployment: istio-ingressgateway.istio-system checked successfully
<a id="__codelineno-11-58" name="__codelineno-11-58" href="#__codelineno-11-58"></a>✔ PodDisruptionBudget: istio-ingressgateway.istio-system checked successfully
<a id="__codelineno-11-59" name="__codelineno-11-59" href="#__codelineno-11-59"></a>✔ Role: istio-ingressgateway-sds.istio-system checked successfully
<a id="__codelineno-11-60" name="__codelineno-11-60" href="#__codelineno-11-60"></a>✔ RoleBinding: istio-ingressgateway-sds.istio-system checked successfully
<a id="__codelineno-11-61" name="__codelineno-11-61" href="#__codelineno-11-61"></a>✔ Service: istio-ingressgateway.istio-system checked successfully
<a id="__codelineno-11-62" name="__codelineno-11-62" href="#__codelineno-11-62"></a>✔ ServiceAccount: istio-ingressgateway-service-account.istio-system checked successfully
<a id="__codelineno-11-63" name="__codelineno-11-63" href="#__codelineno-11-63"></a>Checked <span class="m">15</span> custom resource definitions
<a id="__codelineno-11-64" name="__codelineno-11-64" href="#__codelineno-11-64"></a>Checked <span class="m">3</span> Istio Deployments
<a id="__codelineno-11-65" name="__codelineno-11-65" href="#__codelineno-11-65"></a>✔ Istio is installed and verified successfully
</code></pre></div>
<ul>
<li>Istio Operator Install</li>
<li>
<p>Install with Helm</p>
</li>
<li>
<p>There are also different profiles for production and performance testing and it's important to know that different environments need different profiles.</p>
</li>
<li>Once Istio is installed,</li>
<li>it is deployed in the cluster in the form of a deployment named <code>istiod</code> in the namespace known as the <code>istio-system</code>.</li>
<li>services<ul>
<li><code>istio-ingressgateway</code></li>
<li><code>isitod</code></li>
<li>Citadel</li>
<li>Pilot</li>
<li>Galley</li>
<li><code>istio-egressgateway</code></li>
<li>and a bunch of Kubernetes service objects to expose these services within the cluster.</li>
</ul>
</li>
</ul>
<h3 id="deploying-your-first-application-on-istio">Deploying Your First Application on Istio<a class="headerlink" href="#deploying-your-first-application-on-istio" title="Permanent link">&para;</a></h3>
<p>Deploy the sample booking deployment</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>kubectl apply -f istio-1.14.1/samples/bookinfo/platform/kube/bookinfo.yaml
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>service/details created
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>serviceaccount/bookinfo-details created
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>deployment.apps/details-v1 created
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>service/ratings created
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>serviceaccount/bookinfo-ratings created
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>deployment.apps/ratings-v1 created
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>service/reviews created
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>serviceaccount/bookinfo-reviews created
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>deployment.apps/reviews-v1 created
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>deployment.apps/reviews-v2 created
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>deployment.apps/reviews-v3 created
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>service/productpage created
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>serviceaccount/bookinfo-productpage created
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>deployment.apps/productpage-v1 created
</code></pre></div>
<p>Check all the deployment</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>kubectl get pod
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>NAME                              READY   STATUS    RESTARTS   AGE
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>details-v1-7f4669bdd9-q72n9       <span class="m">1</span>/1     Running   <span class="m">0</span>          3m2s
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>productpage-v1-5586c4d4ff-lghxl   <span class="m">1</span>/1     Running   <span class="m">0</span>          3m
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>ratings-v1-6cf6bc7c85-sv8sf       <span class="m">1</span>/1     Running   <span class="m">0</span>          3m1s
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>reviews-v1-7598cc9867-gt8zn       <span class="m">1</span>/1     Running   <span class="m">0</span>          3m1s
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>reviews-v2-6bdd859457-thjrq       <span class="m">1</span>/1     Running   <span class="m">0</span>          3m1s
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>reviews-v3-6c98f9d7d7-z8qf6       <span class="m">1</span>/1     Running   <span class="m">0</span>          3m1s
</code></pre></div>
<p>We have the deployments in the <code>default</code> namespace but there are no proxies that we needs in each of deployment</p>
<p>To see why may be the case</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>istioctl analyze
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>Info <span class="o">[</span>IST0102<span class="o">]</span> <span class="o">(</span>Namespace default<span class="o">)</span> The namespace is not enabled <span class="k">for</span> Istio injection. Run <span class="s1">&#39;kubectl label namespace default istio-injection=enabled&#39;</span> to <span class="nb">enable</span> it, or <span class="s1">&#39;kubectl label namespace default istio-injection=disabled&#39;</span> to explicitly mark it as not needing injection.
</code></pre></div>
<p>Because the default namespace where our deployment deployed is not labeled with istio-injection=enable, so we need to delete all the deployment to label the namespace</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>kubectl label namespace default istio-injection<span class="o">=</span>enabled
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>namespace/default labeled
</code></pre></div>
<p>Check/analyze again</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>istioctl analyze
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>✔ No validation issues found when analyzing namespace: default.
</code></pre></div>
<p>Delete or restart rollout deployment</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>kubectl rollout restart deployments details-v1
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>kubectl rollout restart deployments productpage-v1
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>kubectl rollout restart deployments ratings-v1
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>kubectl rollout restart deployments reviews-v1
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>kubectl rollout restart deployments reviews-v2
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>kubectl rollout restart deployments reviews-v3
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>deployment.apps/details-v1 restarted
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>deployment.apps/productpage-v1 restarted
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>deployment.apps/ratings-v1 restarted
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>deployment.apps/reviews-v1 restarted
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>deployment.apps/reviews-v2 restarted
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>deployment.apps/reviews-v3 restarted
</code></pre></div>
<p>Check all the deployment</p>
<p>```sh  
kubectl get pod
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>The output is similar to this:
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>```sh
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>NAME                              READY   STATUS    RESTARTS   AGE
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>details-v1-7fd8c8d8c-kw8cx        2/2     Running   0          58s
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>productpage-v1-7444985f97-5hnt6   2/2     Running   0          57s
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>ratings-v1-5bd97d8566-qwmw8       2/2     Running   0          57s
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>reviews-v1-74cffbcd7d-x88hn       2/2     Running   0          57s
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>reviews-v2-6746555c8b-d4rrj       2/2     Running   0          56s
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>reviews-v3-85cb57875d-z6w5m       2/2     Running   0          56s
</code></pre></div></p>
<h3 id="visualizing-service-mesh-with-kiali">Visualizing Service Mesh with Kiali<a class="headerlink" href="#visualizing-service-mesh-with-kiali" title="Permanent link">&para;</a></h3>
<ul>
<li>Once you have many microservices, it is important to observe them and check them to make sure they're available as you configured them.</li>
<li>Kiali is a very common and powerful add-on used with Istio. It has a web-based graphical interface. It is a very helpful and fun tool for visualizing and managing service mesh. Kiali is used for observing connections and microservices of Istio service mesh and also for defining and validating them.</li>
<li>It visualizes the service mesh topology and provides visibility into features like request routing, circuit breakers, request rates, latency and more. Kiali also offers Wizards to apply common traffic patterns and automatically generates Istio configuration.</li>
</ul>
<h4 id="installing-kiali">Installing Kiali<a class="headerlink" href="#installing-kiali" title="Permanent link">&para;</a></h4>
<p>Install Kiali and others add-on in the samples/addons folder (these addons are not tuned in performance and security purposes)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>ls samples/addons
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>kubectl apply -f samples/addons
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>README.md       extras          grafana.yaml    jaeger.yaml     kiali.yaml      prometheus.yaml
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>serviceaccount/grafana created
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>configmap/grafana created
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>service/grafana created
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>deployment.apps/grafana created
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>configmap/istio-grafana-dashboards created
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>configmap/istio-services-grafana-dashboards created
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>deployment.apps/jaeger created
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>service/tracing created
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>service/zipkin created
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>service/jaeger-collector created
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>serviceaccount/kiali created
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>configmap/kiali created
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>clusterrole.rbac.authorization.k8s.io/kiali-viewer created
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>clusterrole.rbac.authorization.k8s.io/kiali created
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>clusterrolebinding.rbac.authorization.k8s.io/kiali created
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>role.rbac.authorization.k8s.io/kiali-controlplane created
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>rolebinding.rbac.authorization.k8s.io/kiali-controlplane created
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>service/kiali created
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>deployment.apps/kiali created
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>serviceaccount/prometheus created
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>configmap/prometheus created
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>clusterrole.rbac.authorization.k8s.io/prometheus created
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>clusterrolebinding.rbac.authorization.k8s.io/prometheus created
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>service/prometheus created
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>deployment.apps/prometheus created
</code></pre></div>
<p>Check if the Kiali service is running</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>kubectl -n istio-system get svc kiali
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>NAME    TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>              AGE
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>kiali   ClusterIP   <span class="m">10</span>.99.20.194   &lt;none&gt;        <span class="m">20001</span>/TCP,9090/TCP   67m
</code></pre></div>
<p>Start Kiali dashboard</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>istioctl dashboard kiali
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>http://localhost:20001/kiali
</code></pre></div>
<h4 id="create-traffic-into-your-mesh">Create traffic into your mesh<a class="headerlink" href="#create-traffic-into-your-mesh" title="Permanent link">&para;</a></h4>
<ul>
<li>Gateway will configure our service mesh to accept traffic from outside the cluster.</li>
</ul>
<p>Create a Gateway and its virtual service</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>gateway.networking.istio.io/bookinfo-gateway created
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>virtualservice.networking.istio.io/bookinfo created
</code></pre></div>
<p>Check/analyze again</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>istioctl analyze
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>✔ No validation issues found when analyzing namespace: default.
</code></pre></div>
<p>Check the reachable IP of minikube - this is the minukube node Internal-IP</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>kubectl get node -o wide
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>NAME       STATUS   ROLES                  AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION     CONTAINER-RUNTIME
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>minikube   Ready    control-plane,master   31m   v1.23.1   <span class="m">192</span>.168.49.2   &lt;none&gt;        Ubuntu <span class="m">20</span>.04.2 LTS   <span class="m">5</span>.10.76-linuxkit   docker://20.10.12
</code></pre></div>
<p>Export this IP to our variable</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nb">export</span> <span class="nv">INGRESS_HOST</span><span class="o">=</span><span class="k">$(</span>minikube ip<span class="k">)</span>
</code></pre></div>
<p>Export the istio-ingressgateway (http2) port to our variable</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nb">export</span> <span class="nv">INGRESS_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl -n istio-system get svc istio-ingressgateway -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.spec.ports[?(@.name==&quot;http2&quot;)].nodePort}&#39;</span><span class="k">)</span>
</code></pre></div>
<p>Create some traffic to our mesh</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="k">while</span> sleep <span class="m">0</span>.01<span class="p">;</span><span class="k">do</span> curl -sS <span class="s1">&#39;http://&#39;</span><span class="s2">&quot;</span><span class="nv">$INGRESS_HOST</span><span class="s2">&quot;</span><span class="s1">&#39;:&#39;</span><span class="s2">&quot;</span><span class="nv">$INGRESS_PORT</span><span class="s2">&quot;</span><span class="s1">&#39;/productpage&#39;</span><span class="se">\ </span><span class="p">&amp;</span>&gt; /dev/null <span class="p">;</span> <span class="k">done</span>
</code></pre></div>
<h2 id="traffic-management">Traffic Management<a class="headerlink" href="#traffic-management" title="Permanent link">&para;</a></h2>
<p>The most powerful port of it is that you'll do it without changing your application code</p>
<h3 id="gateways">Gateways<a class="headerlink" href="#gateways" title="Permanent link">&para;</a></h3>
<ul>
<li>How can we make these services accessible to external users?</li>
<li>While Istio supports Kubernetes Ingress there is also another approach that Istio offers and recommends that supports more Istio features, such as advanced monitoring and routing rules. That is called Istio Gateway.</li>
<li>Gateways are load balancers that sit at the edge of the mesh. They are the main configurations that manage the inbound and the outbound traffic to service mesh. This is a recommended approach such as compared to just using Kubernetes Ingress.</li>
<li>There are Istio gateway controllers just like the Ingress Controller:</li>
<li>The Ingress Gateway manages all inbound traffic to the services.</li>
<li>The Egress Gateway manages all outbound traffic from these services.</li>
<li>Ingress is deployed in Kubernetes using controllers like NGINX. Istio on the other hand, deploys Ingress Gateways using Envoy proxies. And all services have an Envoy proxy deployed as a sidecar container, however, the Ingress and Egress Gateways are just standalone Envoy proxies, sitting at the edge of the service mesh, they do not work as as sidecar. These are the default gateway controllers that were deployed when Istio was deployed on the cluster. However, we can have our own set of custom gateway controllers as well.</li>
<li>
<p>Our goal here is to catch all traffic coming through <code>istio-ingressgateway</code> controller and route all traffic at hostname bookinfo.app to our product page.</p>
</li>
<li>
<p>First, we create a gateway object</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="s">kind: Gateway</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="s">metadata:</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="s">  name: bookinfo-gateway</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="s">spec:</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="s">  selector:</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="s">    istio: ingressgateway # use istio default controller</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="s">  servers:</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="s">  - port:</span>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="s">      number: 80</span>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="s">      name: http</span>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="s">      protocol: HTTP</span>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="s">    hosts:</span>
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="s">    - &quot;bookinfo.app&quot;</span>
<a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="s">EOF</span>
</code></pre></div>
<p>View the gateway</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>kubectl get gateway
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>NAME               AGE
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>bookinfo-gateway   29s
</code></pre></div>
<p>Describe more details the gateway</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>kubectl describe gateway bookinfo-gateway
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>Name:         bookinfo-gateway
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>Namespace:    default
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>Labels:       &lt;none&gt;
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>Annotations:  &lt;none&gt;
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>API Version:  networking.istio.io/v1beta1
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>Kind:         Gateway
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>Metadata:
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>  Creation Timestamp:  <span class="m">2022</span>-07-07T02:24:05Z
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>  Generation:          <span class="m">1</span>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>  Managed Fields:
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>    API Version:  networking.istio.io/v1alpha3
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>    Fields Type:  FieldsV1
<a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a>    fieldsV1:
<a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a>      f:metadata:
<a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a>        f:annotations:
<a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a>          .:
<a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a>          f:kubectl.kubernetes.io/last-applied-configuration:
<a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a>      f:spec:
<a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a>        .:
<a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a>        f:selector:
<a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a>          .:
<a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a>          f:istio:
<a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a>        f:servers:
<a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a>    Manager:         kubectl-client-side-apply
<a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a>    Operation:       Update
<a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a>    Time:            <span class="m">2022</span>-07-07T02:24:05Z
<a id="__codelineno-44-27" name="__codelineno-44-27" href="#__codelineno-44-27"></a>  Resource Version:  <span class="m">1237</span>
<a id="__codelineno-44-28" name="__codelineno-44-28" href="#__codelineno-44-28"></a>  UID:               40b636a4-88ea-4cd9-9294-accd8ce38bfa
<a id="__codelineno-44-29" name="__codelineno-44-29" href="#__codelineno-44-29"></a>Spec:
<a id="__codelineno-44-30" name="__codelineno-44-30" href="#__codelineno-44-30"></a>  Selector:
<a id="__codelineno-44-31" name="__codelineno-44-31" href="#__codelineno-44-31"></a>    Istio:  ingressgateway
<a id="__codelineno-44-32" name="__codelineno-44-32" href="#__codelineno-44-32"></a>  Servers:
<a id="__codelineno-44-33" name="__codelineno-44-33" href="#__codelineno-44-33"></a>    Hosts:
<a id="__codelineno-44-34" name="__codelineno-44-34" href="#__codelineno-44-34"></a>      bookinfo.app
<a id="__codelineno-44-35" name="__codelineno-44-35" href="#__codelineno-44-35"></a>    Port:
<a id="__codelineno-44-36" name="__codelineno-44-36" href="#__codelineno-44-36"></a>      Name:      http
<a id="__codelineno-44-37" name="__codelineno-44-37" href="#__codelineno-44-37"></a>      Number:    <span class="m">80</span>
<a id="__codelineno-44-38" name="__codelineno-44-38" href="#__codelineno-44-38"></a>      Protocol:  HTTP
<a id="__codelineno-44-39" name="__codelineno-44-39" href="#__codelineno-44-39"></a>Events:          &lt;none&gt;
</code></pre></div>
<ul>
<li>We now have a <code>bookinfo-gateway</code> object created to capture traffic coming through the default <code>istio-ingressgateway</code> controller, through the URL bookinfo.app.</li>
</ul>
<h3 id="virtual-services">Virtual Services<a class="headerlink" href="#virtual-services" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>How and where is that traffic routed to?</p>
</li>
<li>
<p>All routing rules are configured through virtual services.</p>
</li>
<li>Virtual services define a set of routing rules for traffic coming from ingress gateway into the service mesh.</li>
<li>Virtual services are flexible and powerful with rich traffic routing options. You can specify traffic behavior for one or more hostname, manage traffic within different versions of a service. Standard and regex path are supported.</li>
<li>When a virtual service is created, Istio control plane applies the new configuration to all the Envoy sidecar proxies.</li>
</ul>
<p>Create a virtual service for product page:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="s">kind: VirtualService</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="s">metadata:</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="s">  name: bookinfo</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="s">spec:</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="s">  hosts:</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="s">  - &quot;bookinfo.app&quot;</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="s">  gateways:</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="s">  - bookinfo-gateway</span>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="s">  http:</span>
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="s">  - match:</span>
<a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="s">    - uri:</span>
<a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="s">        exact: /productpage</span>
<a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="s">    - uri:</span>
<a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="s">        prefix: /static</span>
<a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="s">    - uri:</span>
<a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="s">        exact: /login</span>
<a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="s">    - uri:</span>
<a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a><span class="s">        exact: /logout</span>
<a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a><span class="s">    - uri:</span>
<a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a><span class="s">        prefix: /api/v1/products</span>
<a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a><span class="s">    route:</span>
<a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a><span class="s">    - destination:</span>
<a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a><span class="s">        host: productpage</span>
<a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a><span class="s">        port:</span>
<a id="__codelineno-45-27" name="__codelineno-45-27" href="#__codelineno-45-27"></a><span class="s">          number: 9080</span>
<a id="__codelineno-45-28" name="__codelineno-45-28" href="#__codelineno-45-28"></a><span class="s">EOF</span>
</code></pre></div>
<ul>
<li>All traffic coming in through the <code>bookinfo-gateway</code> with the hostname <code>bookinfo.app</code> now hit the <code>bookinfo</code> virtual service. Next, the product page needs to talk to the review service. Since the Kubernetes service distributes traffic across all of endpoints equally, the distribution can only be 75 and 25 percentage not anything else. The only way to change the distribution percentage is to play around with the number of pods available in different services, so that's a limitation.</li>
<li>With Istio and virtual services, we can now create a virtual service instead of a service, and we will call it <code>reviews</code>, we then define two destination routes for traffic distribution subset v1 and v2, then we set a weight for each.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="s">kind: VirtualService</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="s">metadata:</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="s">  name: reviews</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="s">spec:</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="s">  hosts:</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="s">    - reviews</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="s">  http:</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="s">  - route:</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="s">    - destination:</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="s">        host: reviews</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="s">        subset: v1</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="s">      weight: 99 # route 99% of the traffic to v1</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="s">    - destination:</span>
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="s">        host: reviews</span>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="s">        subset: v2</span>
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="s">      weight: 1 # route 1% of the traffic to v2</span>
<a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="s">EOF</span>
</code></pre></div>
<h3 id="destination-rules">Destination Rules<a class="headerlink" href="#destination-rules" title="Permanent link">&para;</a></h3>
<ul>
<li>Destination rule applies router polices after the traffic is routed to a specific service.</li>
<li>
<p>Where and how are these subsets defined?</p>
</li>
<li>
<p>Subsets are defined in destination rules. So, we create a destination rule with the kind set to DestinationRule, name set to reviews-destination, and host set to reviews.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="s">kind: DestinationRule</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="s">metadata:</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="s">  name: reviews-destination</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="s">spec:</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="s">  host: reviews</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="s">  subsets:</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="s">  - name: v1</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="s">    labels:</span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="s">      version: v1</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="s">  - name: v2</span>
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="s">    labels:</span>
<a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="s">      version: v2</span>
<a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="s">EOF</span>
</code></pre></div>
<ul>
<li>By default, Envoy load balances traffic in a round-robin fashion. This can be customized through the destination rule by specifying a traffic policy of load balancer.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="s">kind: DestinationRule</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="s">metadata:</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="s">  name: reviews-destination</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="s">spec:</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="s">  host: reviews</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="s">  trafficPolicy:</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="s">    loadBalancer:</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="s">      simple: PASSTHROUGH # This will route traffic to the host that has fewer active requests.</span>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="s">  subsets:</span>
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="s">  - name: v1</span>
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="s">    labels:</span>
<a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="s">      version: v1</span>
<a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="s">  - name: v2</span>
<a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="s">    labels:</span>
<a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="s">      version: v2</span>
<a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a><span class="s">EOF</span>
</code></pre></div>
<ul>
<li>Set the traffic policy to a simple passthrough policy. This will route traffic to the host that has fewer active requests. There are other simple algorithms:</li>
</ul>
<table>
<thead>
<tr>
<th>Simple Algorithms</th>
</tr>
</thead>
<tbody>
<tr>
<td>ROUND_ROBIN</td>
</tr>
<tr>
<td>LEAST_CONN</td>
</tr>
<tr>
<td>RANDOM</td>
</tr>
<tr>
<td>PASSTHROUGH</td>
</tr>
</tbody>
</table>
<ul>
<li>What if we want to override a different load balancer policy for specific subsets? For example, for subset v2, we would like to have a random load balancer policy. For this, we'll just specify a traffic policy at the subset level and configure a different policy. This way, we can configure one load balancing policy for all subsets and a seperate one for selected subsets as required.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="s">kind: DestinationRule</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="s">metadata:</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="s">  name: reviews-destination</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="s">spec:</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="s">  host: reviews</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="s">  trafficPolicy:</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="s">    loadBalancer:</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="s">      simple: PASSTHROUGH</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="s">  subsets:</span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="s">  - name: v1</span>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="s">    labels:</span>
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="s">      version: v1</span>
<a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a><span class="s">  - name: v2</span>
<a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="s">    labels:</span>
<a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a><span class="s">      version: v2</span>
<a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a><span class="s">      trafficPolicy:</span>
<a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a><span class="s">        loadBalancer:</span>
<a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a><span class="s">          simple: RANDOM</span>
<a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a><span class="s">EOF</span>
</code></pre></div>
<ul>
<li>There are many more configurations supported by destination rules. For example, to configure a client to use TLS, specify simple TLS, or to configure mutual TLS</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="s">kind: DestinationRule</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="s">metadata:</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="s">  name: reviews-destination</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="s">spec:</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="s">  host: reviews</span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="s">  trafficPolicy:</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="s">    tls:</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="s">      mode: SIMPLE # use simple TLS</span>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="s">EOF</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="s">kind: DestinationRule</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="s">metadata:</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="s">  name: reviews-destination</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="s">spec:</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="s">  host: reviews</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="s">  trafficPolicy:</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="s">    tls:</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="s">      mode: MUTUAL # configure mutual TLS with certificate files</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="s">      clientCertificate: /myclientcert.pem</span>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="s">      privateKey: /client_private_key.pem</span>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="s">      caCertificate: /rootcacerts.pem</span>
<a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="s">EOF</span>
</code></pre></div>
<ul>
<li><code>spec.host</code> field it is currently set to <code>reviews</code>, which is the name of the service. It is the short name of the service. When using short names, instead of fully qualified domain names <code>reviews.default.svc.cluster.local</code>, Istio will interpret the short name based on the rules namespace and not the services actual namespaces. This might lead to misconfigurations if your service is another namespace. To avoid this, using fully qualified names over short names is recommended.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="s">kind: DestinationRule</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="s">metadata:</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="s">  name: reviews-destination</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="s">spec:</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="s">  host: reviews.default.svc.cluster.local # recommend to use FQDN instead of short name</span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="s">  trafficPolicy:</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="s">    tls:</span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="s">      mode: MUTUAL</span>
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="s">      clientCertificate: /myclientcert.pem</span>
<a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="s">      privateKey: /client_private_key.pem</span>
<a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="s">      caCertificate: /rootcacerts.pem</span>
<a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="s">EOF</span>
</code></pre></div>
<h3 id="fault-injection">Fault Injection<a class="headerlink" href="#fault-injection" title="Permanent link">&para;</a></h3>
<ul>
<li>We will generate some errors to check if error handling mechanisms are working as expected. That is fault injection. This is a testing approach. It helps us to see if our policies run efficiently and are not too restrictive.</li>
<li>We can inject errors in our virtual services and these could be two different types of errors, delays and aborts.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="s">kind: VirtualService</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="s">metadata:</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="s">  name: my-service</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="s">spec:</span>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="s">  hosts:</span>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="s">  - my-service</span>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="s">  http:</span>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="s">  - fault:</span>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="s">      delay: # injecting a delay type of fault in the mesh for ratings virtual service</span>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="s">        percentage:</span>
<a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="s">          value: 0.1 # add a delay for 10% of requests</span>
<a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="s">        fixedDelay: 5s # this delay is configured as 5 seconds</span>
<a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a><span class="s">    route:</span>
<a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a><span class="s">    - destination:</span>
<a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="s">        host: my-service</span>
<a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a><span class="s">        subset: v1</span>
<a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="s">EOF</span>
</code></pre></div>
<p>Apart from delay, you can also configure abort to simulate errors by rejecting requests and returning specific error codes.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="s">kind: VirtualService</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="s">metadata:</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="s">  name: my-service</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="s">spec:</span>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="s">  hosts:</span>
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="s">  - my-service</span>
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="s">  http:</span>
<a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="s">  - fault:</span>
<a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="s">      abort:</span>
<a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="s">        percentage:</span>
<a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a><span class="s">          value: 0.1</span>
<a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a><span class="s">        httpStatus: 400</span>
<a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a><span class="s">    route:</span>
<a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a><span class="s">    - destination:</span>
<a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a><span class="s">        host: my-service</span>
<a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a><span class="s">        subset: v1</span>
<a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a><span class="s">EOF</span>
</code></pre></div>
<h3 id="timeouts">Timeouts<a class="headerlink" href="#timeouts" title="Permanent link">&para;</a></h3>
<ul>
<li>When it comes to software, you must know that anything could happen. Since each service within this microservice architecture is a software, we should expect them to slow down, fail, or go completely crazy for no obvious reasons. And since the services are dependent on each other, slowness on one service might affect the other services dependent on it and even have a cascading effect.</li>
<li>For example:</li>
<li>If the ratings service slows down for some reason, we will have requests queued at it, which is going to cause requests on the reviews service to be queued up, which is going to cause the requests on productpage to be queued up.</li>
<li>The details service slows down, then the requests coming from product page to details service is going to get queued up, and the request sub-productpage is going to get queued up affecting all users accessing the application. That's why we need timeouts.</li>
<li>If the service is taking too much time to response, it must not keep the dependent service waiting forever. It must fail after a period of time and return an error message. That way the dependent service gets an error message and is not impacted. That's what a timeout is.</li>
<li>We can either configure a timeout at the details service for it to fail, or we can configure a timeout at the productpage service for it to fail sooner rather than waiting for the details service for eternity.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="s">kind: VirtualService</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="s">metadata:</span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="s">  name: bookinfo</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="s">spec:</span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="s">  hosts:</span>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="s">  - &quot;*&quot;</span>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="s">  gateways:</span>
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="s">  - bookinfo-gateway</span>
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="s">  http:</span>
<a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="s">  - match:</span>
<a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="s">    - uri:</span>
<a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a><span class="s">        exact: /productpage</span>
<a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="s">    - uri:</span>
<a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="s">        prefix: /static</span>
<a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a><span class="s">    - uri:</span>
<a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a><span class="s">        exact: /login</span>
<a id="__codelineno-55-19" name="__codelineno-55-19" href="#__codelineno-55-19"></a><span class="s">    - uri:</span>
<a id="__codelineno-55-20" name="__codelineno-55-20" href="#__codelineno-55-20"></a><span class="s">        exact: /logout</span>
<a id="__codelineno-55-21" name="__codelineno-55-21" href="#__codelineno-55-21"></a><span class="s">    - uri:</span>
<a id="__codelineno-55-22" name="__codelineno-55-22" href="#__codelineno-55-22"></a><span class="s">        prefix: /api/v1/products</span>
<a id="__codelineno-55-23" name="__codelineno-55-23" href="#__codelineno-55-23"></a><span class="s">    route:</span>
<a id="__codelineno-55-24" name="__codelineno-55-24" href="#__codelineno-55-24"></a><span class="s">    - destination:</span>
<a id="__codelineno-55-25" name="__codelineno-55-25" href="#__codelineno-55-25"></a><span class="s">        host: productpage</span>
<a id="__codelineno-55-26" name="__codelineno-55-26" href="#__codelineno-55-26"></a><span class="s">        port:</span>
<a id="__codelineno-55-27" name="__codelineno-55-27" href="#__codelineno-55-27"></a><span class="s">          number: 9080</span>
<a id="__codelineno-55-28" name="__codelineno-55-28" href="#__codelineno-55-28"></a><span class="s">    timeout: 3s # reject requests if it takes more than 3 seconds</span>
<a id="__codelineno-55-29" name="__codelineno-55-29" href="#__codelineno-55-29"></a><span class="s">EOF</span>
</code></pre></div>
<p>Simulate the fault injection to set 50% of request to details service to be delayed 5 seconds</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="s">kind: VirtualService</span>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="s">metadata:</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="s">  name: details</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="s">spec:</span>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="s">  hosts:</span>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="s">    - details</span>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="s">  http:</span>
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="s">  - fault:</span>
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="s">      delay:</span>
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="s">        percentage:</span>
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="s">          value: 50.0</span>
<a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a><span class="s">        fixedDelay: 5s</span>
<a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a><span class="s">    route:</span>
<a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a><span class="s">    - destination:</span>
<a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a><span class="s">        host: details</span>
<a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a><span class="s">        subset: v1</span>
<a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a><span class="s">EOF</span>
</code></pre></div>
<h3 id="retries">Retries<a class="headerlink" href="#retries" title="Permanent link">&para;</a></h3>
<ul>
<li>When a service tries to reach another service, and for some reason, it fails, we can configure the virtual service to attempt that operation again. This way, you don't have to handle the retries within the application code. You can configure retry settings, which basically says</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="s">kind: VirtualService</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="s">metadata:</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="s">  name: my-service</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="s">spec:</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="s">  hosts:</span>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="s">  - my-service</span>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="s">  http:</span>
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="s">  - route:</span>
<a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="s">    - destination:</span>
<a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a><span class="s">        host: my-service</span>
<a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a><span class="s">        subset: v1</span>
<a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a><span class="s">    retries:</span>
<a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a><span class="s">      attempts: 3 # number of times to try</span>
<a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a><span class="s">      perTryTimeout: 2s # interval between each try</span>
<a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a><span class="s">EOF</span>
</code></pre></div>
<blockquote>
<p><strong>NOTE</strong>: Istio, by default, has a retry behavior which is 25 milliseconds between retries and retrying 2 times before an error returns.</p>
</blockquote>
<h3 id="circuit-breaking">Circuit Breaking<a class="headerlink" href="#circuit-breaking" title="Permanent link">&para;</a></h3>
<ul>
<li>The productpage service communicates with other services such as the reviews or the details service. If, for some reason, the details service breaks or slows down and is unable to serve the product service, all requests from the productpage service will pile up at the detail service, essentially creating a delay as the productpage service is waiting for response from the detail service. In such cases, we would like to mark the requests failed immediately as it is sent to the details service. This is known as circuit breaking. This allows us to create resilient microservice applications that will limit the impact of failures or other network-related issues. The same is true if we would like to limit the number of request coming to the productpage itself.</li>
<li>Circuit breakers are configured in destination rules.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="s">apiVersion: networking.istio.io/v1alpha3</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="s">kind: DestinationRule</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="s">metadata:</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="s">  name: productpage</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="s">spec:</span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="s">  host: productpage</span>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="s">  trafficPolicy:</span>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="s">    tls:</span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="s">      mode: ISTIO_MUTUAL</span>
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="s">  subsets:</span>
<a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a><span class="s">  - name: v1</span>
<a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a><span class="s">    labels:</span>
<a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a><span class="s">      version: v1</span>
<a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a><span class="s">    trafficPolicy:</span>
<a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a><span class="s">      connectionPool:</span>
<a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a><span class="s">        tcp:</span>
<a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a><span class="s">          maxConnections: 3 # limit the number of concurrent connections to 3</span>
<a id="__codelineno-58-19" name="__codelineno-58-19" href="#__codelineno-58-19"></a><span class="s">        http:</span>
<a id="__codelineno-58-20" name="__codelineno-58-20" href="#__codelineno-58-20"></a><span class="s">          http1MaxPendingRequests: 3</span>
<a id="__codelineno-58-21" name="__codelineno-58-21" href="#__codelineno-58-21"></a><span class="s">          maxRequestsPerConnection: 3</span>
<a id="__codelineno-58-22" name="__codelineno-58-22" href="#__codelineno-58-22"></a><span class="s">EOF</span>
</code></pre></div>
<p>Create concurrent requests</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>h2load -n10 -c3 http://istio.dev.bein.group/productpage
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>starting benchmark...
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>spawning thread <span class="c1">#0: 3 total client(s). 10 total requests</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>Application protocol: h2c
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>progress: <span class="m">10</span>% <span class="k">done</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>progress: <span class="m">20</span>% <span class="k">done</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>progress: <span class="m">30</span>% <span class="k">done</span>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a>progress: <span class="m">40</span>% <span class="k">done</span>
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a>progress: <span class="m">50</span>% <span class="k">done</span>
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a>progress: <span class="m">60</span>% <span class="k">done</span>
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a>progress: <span class="m">70</span>% <span class="k">done</span>
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a>progress: <span class="m">80</span>% <span class="k">done</span>
<a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a>progress: <span class="m">90</span>% <span class="k">done</span>
<a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a>progress: <span class="m">100</span>% <span class="k">done</span>
<a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a>
<a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a>finished <span class="k">in</span> <span class="m">9</span>.65s, <span class="m">1</span>.04 req/s, <span class="m">1</span>.40KB/s
<a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a>requests: <span class="m">10</span> total, <span class="m">10</span> started, <span class="m">10</span> <span class="k">done</span>, <span class="m">3</span> succeeded, <span class="m">7</span> failed, <span class="m">0</span> errored, <span class="m">0</span> timeout
<a id="__codelineno-60-17" name="__codelineno-60-17" href="#__codelineno-60-17"></a>status codes: <span class="m">3</span> 2xx, <span class="m">0</span> 3xx, <span class="m">0</span> 4xx, <span class="m">7</span> 5xx
<a id="__codelineno-60-18" name="__codelineno-60-18" href="#__codelineno-60-18"></a>traffic: <span class="m">13</span>.55KB <span class="o">(</span><span class="m">13876</span><span class="o">)</span> total, 454B <span class="o">(</span><span class="m">454</span><span class="o">)</span> headers <span class="o">(</span>space savings <span class="m">59</span>.61%<span class="o">)</span>, <span class="m">12</span>.74KB <span class="o">(</span><span class="m">13050</span><span class="o">)</span> data
<a id="__codelineno-60-19" name="__codelineno-60-19" href="#__codelineno-60-19"></a>                     min         max         mean         sd        +/- sd
<a id="__codelineno-60-20" name="__codelineno-60-20" href="#__codelineno-60-20"></a><span class="nb">time</span> <span class="k">for</span> request:   <span class="m">323</span>.12ms       <span class="m">3</span>.18s       <span class="m">2</span>.27s       <span class="m">1</span>.32s    <span class="m">70</span>.00%
<a id="__codelineno-60-21" name="__codelineno-60-21" href="#__codelineno-60-21"></a><span class="nb">time</span> <span class="k">for</span> connect:    <span class="m">45</span>.68ms     <span class="m">46</span>.04ms     <span class="m">45</span>.83ms       187us    <span class="m">66</span>.67%
<a id="__codelineno-60-22" name="__codelineno-60-22" href="#__codelineno-60-22"></a><span class="nb">time</span> to 1st byte:      <span class="m">3</span>.09s       <span class="m">3</span>.10s       <span class="m">3</span>.09s       685us    <span class="m">66</span>.67%
<a id="__codelineno-60-23" name="__codelineno-60-23" href="#__codelineno-60-23"></a>req/s           :       <span class="m">0</span>.41        <span class="m">0</span>.46        <span class="m">0</span>.44        <span class="m">0</span>.02    <span class="m">66</span>.67%
</code></pre></div>
<h3 id="ab-testing">A/B Testing<a class="headerlink" href="#ab-testing" title="Permanent link">&para;</a></h3>
<ul>
<li>A/B Testing is a very popular and powerful approach to understand user behavior. It boosts experimentation and helps our software professionals to not guess how our applications will be interacted, but to see it on real data.</li>
<li>Istio allows to weight the traffic to several services via virtual service even if the reviews v2 service had 3 or more pods, the traffic distribution will still be 99% to v1 and 1% to v2. The number of instances now has nothing to do with the traffic distribution, and we can easily control that through the virtual service configuration.</li>
</ul>
<h2 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h2>
<h3 id="security-in-istio">Security in Istio<a class="headerlink" href="#security-in-istio" title="Permanent link">&para;</a></h3>
<ul>
<li>Microservices have certain security requirements. When a service communicates with other service, it's possible for an attacker to intercept the traffic and modify it before the request reaches the destination. This is known as man-in-the-middle attack.</li>
<li>To prevent this from happening:</li>
<li>First, the traffic between services needs to be encrypted.</li>
<li>Secondly, certain services may need to implement access control restrictions. For example, only the productpage service is allowed to access the reviews service and not the details service or any other services in the cluster. For this, we need access control. Istio allows this using mutual TLS and fine-grained access policies.</li>
<li>Finally, we'd like to know who did what at what time. And for this, Istio provides support for audits logs.</li>
</ul>
<h3 id="istio-security-architecture">Istio Security Architecture<a class="headerlink" href="#istio-security-architecture" title="Permanent link">&para;</a></h3>
<ul>
<li>Now take a look at the Istio architecture and see how Istio implements security to achieve the requirements of microservices applications.</li>
</ul>
<p><img alt="Isito Security Architecture" src="../../../../../images/devops/istio-security-architecture.svg" /></p>
<ul>
<li>Control plane</li>
<li>Istiod<ul>
<li>There is a certification authority that manages keys and certificates in Istio. This is where the certificates are validated and certificate signing requests are approved. Every time a workload is started, the Envoy proxies request the certificate and key from the Istio agent and that helps secure communication between services.</li>
<li>The configuration API server component distributes all the authentication, authorization, and secure naming policies to the proxies.</li>
</ul>
</li>
<li>Data plane</li>
<li>Sidecar and ingress/egress proxies work as Policy Enforcement Points. The certificate, keys, authentications, authorization, and secure naming policies are sent to these proxies at all times. This means every point has security checks, not just the entry point to the network, and this is called security at depth.</li>
</ul>
<h3 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h3>
<ul>
<li>In service-oriented architecture, we need to make sure that communication between two services are authenticated.Meaning, when a service tries to communicate with another service, there should be a way to confirm they're really who they say they are. This is done by hardening traffic using verification options like mutual TLS and JSON Web Token validation.</li>
<li>For example, when the productpage service tries to reach the reviews service, the reviews services needs to know that the request is actually coming from the productpage service and not from an external source who pretends to be the productpage service, so the traffic between one service to the other needs to be verified.</li>
<li>With mTLS, each service gets its own identity <strong>Peer Authentication</strong>, which is enforced using certificate key pairs. This certificate generation and distribution are all managed automatically by <code>istiod</code>. So there's nothing extra that you have to do on the services.</li>
<li>Another area to be authenticated is the end users' access to services. For this, Istio supports <strong>Request Authentication</strong> using JSON Web Token validation or OpenID Connect providers some of which are:</li>
<li>ORY Hydra</li>
<li>Keycloak</li>
<li>Firebase</li>
<li>Google</li>
<li>Example for Peer Authentication config, this policy in the book-info namespace and only be effective on workloads labeled with the key app and value set to reviews, and say that these workloads must strictly use Mutual TLS. In this case, we have enabled authentication only for the reviews app, and so we have only enabled it for a single workload. This is a workload-specific policy.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="s">apiVersion: security.istio.io/v1beta1</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="s">kind: PeerAuthentication</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="s">metadata:</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="s">  name: peer-policy</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="s">  namespace: book-info</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="s">spec:</span>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="s">  selector:</span>
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="s">    matchLabels:</span>
<a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="s">      app: reviews # only effective on workload with this label</span>
<a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="s">  mtls:</span>
<a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="s">    mode: STRICT # strictly use Mutual TLS</span>
<a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="s">EOF</span>
</code></pre></div>
<ul>
<li>If you remove the selector specification, the policy will be enabled for the entire namespace, so then this would be a namespace-wide policy that is applied to all workloads within the book-info namespace</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="s">apiVersion: security.istio.io/v1beta1</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="s">kind: PeerAuthentication</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="s">metadata:</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="s">  name: peer-policy</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="s">  namespace: book-info</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="s">spec:</span>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="s">  mtls:</span>
<a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="s">    mode: STRICT # strictly use Mutual TLS for entire namespace</span>
<a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="s">EOF</span>
</code></pre></div>
<ul>
<li>If we set the namespace to the root namespace <code>istio-system</code> so then this become a mesh-wide policy that is applicable to the entire mesh.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="s">apiVersion: security.istio.io/v1beta1</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="s">kind: PeerAuthentication</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="s">metadata:</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="s">  name: peer-policy</span>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="s">  namespace: isito-system # this is the mesh-wide policy</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="s">spec:</span>
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="s">  mtls:</span>
<a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="s">    mode: STRICT</span>
<a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="s">EOF</span>
</code></pre></div>
<ul>
<li>If your namespace is not injection enabled, you still can manual inject Istio proxy sidecars to deployment, but manual injection will change the deployment configuration by adding proxy configuration into it. So it works a little differently.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="c1"># Update resources on the fly before applying.</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>kubectl apply -f &lt;<span class="o">(</span>istioctl kube-inject -f &lt;resource.yaml&gt;<span class="o">)</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="c1"># Create a persistent version of the deployment with Istio sidecar injected.</span>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>istioctl kube-inject -f deployment.yaml -o deployment-injected.yaml
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="c1"># Update an existing deployment.</span>
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>kubectl get deployment -o yaml <span class="p">|</span> istioctl kube-inject -f - <span class="p">|</span> kubectl apply -f -
</code></pre></div>
<p>Demo Peer Authentication, workloads that do not apply the same mode cannot reach our application.</p>
<p>Create new namespace bar</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>kubectl create ns bar
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>namespace/bar created
</code></pre></div>
<p>Manual inject Istio proxy sidecars into HTTPbin deployment and deploy</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>kubectl apply -f &lt;<span class="o">(</span>istioctl kube-inject -f samples/httpbin/httpbin.yaml<span class="o">)</span> -n bar
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>serviceaccount/httpbin created
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>service/httpbin created
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>deployment.apps/httpbin created
</code></pre></div>
<p>Curl from HTTPbin to the productpage</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>kubectl <span class="nb">exec</span> -it <span class="s2">&quot;</span><span class="k">$(</span>kubectl get pod -l <span class="nv">app</span><span class="o">=</span>httpbin -n bar -o <span class="nv">jsonpath</span><span class="o">={</span>.items..metadata.name<span class="o">}</span><span class="k">)</span><span class="s2">&quot;</span> -c istio-proxy -n bar -- curl <span class="s2">&quot;http://productpage.default:9080&quot;</span> -s -o /dev/null -w <span class="s2">&quot;%{http_code}\n&quot;</span>
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="m">200</span>
</code></pre></div>
<p>Apply the Peer Authentication for default namespace mTLS mode strict</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="s">apiVersion: security.istio.io/v1beta1</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="s">kind: PeerAuthentication</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="s">metadata:</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="s">  name: peer-policy</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="s">  namespace: default</span>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="s">spec:</span>
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="s">  mtls:</span>
<a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="s">    mode: STRICT</span>
<a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="s">EOF</span>
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>peerauthentication.security.istio.io/peer-policy created
</code></pre></div>
<p>Curl from HTTPbin to the productpage again</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>kubectl <span class="nb">exec</span> -it <span class="s2">&quot;</span><span class="k">$(</span>kubectl get pod -l <span class="nv">app</span><span class="o">=</span>httpbin -n bar -o <span class="nv">jsonpath</span><span class="o">={</span>.items..metadata.name<span class="o">}</span><span class="k">)</span><span class="s2">&quot;</span> -c istio-proxy -n bar -- curl <span class="s2">&quot;http://productpage.default:9080&quot;</span> -s -o /dev/null -w <span class="s2">&quot;%{http_code}\n&quot;</span>
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="m">000</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="nb">command</span> terminated with <span class="nb">exit</span> code <span class="m">56</span>
</code></pre></div>
<h3 id="authorization">Authorization<a class="headerlink" href="#authorization" title="Permanent link">&para;</a></h3>
<ul>
<li>Authorization in Istio provides a flexible approach to access control for inbound traffic. We can control which service can reach which service, which is referred to as east-west traffic using authorization configuration.</li>
<li>With authentication policies, we now have the end-user traffic as well as service-to-service traffic secured. What about access control? For example, we would like to only allow the productpage service to access the reviews service and not the details or any other services. Also, the productpage service is only supposed to run GET calls to reviews service and not POST or UPDATE calls. We do not want anyone gaining access to the productpage service to make POST calls to the reviews service in an attempt to update or change reviews. And for this purpose, Istio provides authorization mechanisms that allow us to define policies to allow or deny requests based on certain criteria.</li>
<li>These services don't require any changes to implement authorization. This is implemented by Envoy proxies authorization engine in runtime. When a request comes through the proxy, the authorization engine evaluates the request context against the current authorization policies and returns the authorization result either allow or deny. There are 4 actions that authorization policies support, CUSTOM, DENY, ALLOW, and AUDIT:</li>
<li>ALLOW action allows a request to go through.</li>
<li>DENY action denies a request from going through.</li>
<li>CUSTION action allows an extension to handle the request.</li>
<li>AUDIT action - Authorization policies can also be configured to audit requests. With this option, when a request hits the matching rule, it gets audited.</li>
<li>Example of an authorization policy:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="s">apiVersion: security.istio.io/v1beta1</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="s">kind: AuthorizationPolicy</span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="s">metadata:</span>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="s">  name: authdenypolicy</span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="s">  namespace: bookinfo</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="s">spec:</span>
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="s">  action: DENY # this policy deines all POST requests from the bar namespace to the bookinfo namespace</span>
<a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="s">  rules:</span>
<a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="s">  - from:</span>
<a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="s">    - source:</span>
<a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="s">        namespace: [&quot;bar&quot;]</span>
<a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="s">    to:</span>
<a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a><span class="s">    - operation:</span>
<a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a><span class="s">        methods: [&quot;POST&quot;]</span>
<a id="__codelineno-75-16" name="__codelineno-75-16" href="#__codelineno-75-16"></a><span class="s">EOF</span>
</code></pre></div>
<h3 id="certificate-management">Certificate Management<a class="headerlink" href="#certificate-management" title="Permanent link">&para;</a></h3>
<p><img alt="Identity Provisioning Workflow" src="../../../../../images/devops/istio-identity-provisioning-workflow.svg" /></p>
<p>This is a diagram of key and certification flow in Istio, so when a service is started, it needs to identify itself to the mesh control plane and retrieve a certificate in order to serve traffic. Istio only has a built-in certificate authority.</p>
<ul>
<li>The <code>Istio agent</code> in a service creates a private key and a certificate signing request, and then sends the certificate signing request with its credentials to <code>istiod</code> for signing.</li>
<li>The CA in <code>istiod</code> validates the credentials carried in the CSR. Upon successful validation, it signs the CSR to generate the certificate.</li>
<li>The <code>Istio agent</code> sends the certificates received from <code>istiod</code> and the private key to Envoy proxy</li>
<li><code>Istio agent</code> monitors the expiration of the workload certificate.</li>
</ul>
<p>The above process repeats periodically for certificates and key rotation.</p>
<p>It is important to note that for production-grade clusters, you should use a production-ready CA such as HashiCorp Vault and put your certificates in an oven machine or the fridge.</p>
<p>Create our own root certificate</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="nb">cd</span> ~/DevSecOps/demo/istio/istio-1.14.1
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>mkdir ca-certs
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="nb">cd</span> ca-certs
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>make -f ../tools/certs/Makefile.selfsigned.mk root-ca
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>generating root-key.pem
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>Generating RSA private key, <span class="m">4096</span> bit long modulus
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>.................++
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>...................................................................................................................................................................................................................++
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>e is <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a>generating root-cert.csr
<a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a>generating root-cert.pem
<a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a>Signature ok
<a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="nv">subject</span><span class="o">=</span>/O<span class="o">=</span>Istio/CN<span class="o">=</span>Root CA
<a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a>Getting Private key
</code></pre></div>
<p>Here are 4 files that are generated with above command</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>ls
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>root-ca.conf  root-cert.csr root-cert.pem root-key.pem
</code></pre></div>
<ul>
<li><code>root-ca.conf</code> is the configuration for OpenSSL to generate the root certificate.</li>
<li><code>root-cert.csr</code> is a generated CSR for the root certificate.</li>
<li><code>root-cert.pem</code> is a generated root certificate.</li>
<li><code>root-key.pem</code> is a generated root key.</li>
</ul>
<p>Now we will create our immediate certificates.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>make -f  ../tools/certs/Makefile.selfsigned.mk  localcluster-cacerts
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>generating localcluster/ca-key.pem
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>Generating RSA private key, <span class="m">4096</span> bit long modulus
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>........................................................................................................................................................................................................................................................................................................................++
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>.++
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>e is <span class="m">65537</span> <span class="o">(</span>0x10001<span class="o">)</span>
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>generating localcluster/cluster-ca.csr
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>generating localcluster/ca-cert.pem
<a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a>Signature ok
<a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="nv">subject</span><span class="o">=</span>/O<span class="o">=</span>Istio/CN<span class="o">=</span>Intermediate CA/L<span class="o">=</span>localcluster
<a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a>Getting CA Private Key
<a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a>generating localcluster/cert-chain.pem
<a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a>Intermediate inputs stored <span class="k">in</span> localcluster/
<a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a><span class="k">done</span>
<a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a>rm localcluster/cluster-ca.csr localcluster/intermediate.conf
</code></pre></div>
<blockquote>
<p>Root certificates should not be used directly, because it is very dangerous, and also not very practical to use them. Above they are also created</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="nb">cd</span> localcluster
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>ls
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>ca-cert.pem    ca-key.pem     cert-chain.pem root-cert.pem
</code></pre></div>
<blockquote>
<p>Important: you need to delete if you pre-installed Istio, or at least delete the istio-system namespace to configure Istio to use our certificate.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>kubeclt delete ns istio-system
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>namespace <span class="s2">&quot;istio-system&quot;</span> deleted
</code></pre></div>
<p>Then you can as well start with a fresh cluster</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="nb">cd</span> ../../
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>./samples/bookinfo/platform/kube/cleanup.sh
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>namespace ? <span class="o">[</span>default<span class="o">]</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>using <span class="nv">NAMESPACE</span><span class="o">=</span>default
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>destinationrule.networking.istio.io <span class="s2">&quot;details&quot;</span> deleted
<a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>destinationrule.networking.istio.io <span class="s2">&quot;productpage&quot;</span> deleted
<a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a>destinationrule.networking.istio.io <span class="s2">&quot;ratings&quot;</span> deleted
<a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a>destinationrule.networking.istio.io <span class="s2">&quot;reviews&quot;</span> deleted
<a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a>virtualservice.networking.istio.io <span class="s2">&quot;bookinfo&quot;</span> deleted
<a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a>gateway.networking.istio.io <span class="s2">&quot;bookinfo-gateway&quot;</span> deleted
<a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a>Application cleanup may take up to one minute
<a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a>service <span class="s2">&quot;details&quot;</span> deleted
<a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a>serviceaccount <span class="s2">&quot;bookinfo-details&quot;</span> deleted
<a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a>deployment.apps <span class="s2">&quot;details-v1&quot;</span> deleted
<a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a>service <span class="s2">&quot;ratings&quot;</span> deleted
<a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a>serviceaccount <span class="s2">&quot;bookinfo-ratings&quot;</span> deleted
<a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a>deployment.apps <span class="s2">&quot;ratings-v1&quot;</span> deleted
<a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a>service <span class="s2">&quot;reviews&quot;</span> deleted
<a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a>serviceaccount <span class="s2">&quot;bookinfo-reviews&quot;</span> deleted
<a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a>deployment.apps <span class="s2">&quot;reviews-v1&quot;</span> deleted
<a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a>deployment.apps <span class="s2">&quot;reviews-v2&quot;</span> deleted
<a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a>deployment.apps <span class="s2">&quot;reviews-v3&quot;</span> deleted
<a id="__codelineno-87-21" name="__codelineno-87-21" href="#__codelineno-87-21"></a>service <span class="s2">&quot;productpage&quot;</span> deleted
<a id="__codelineno-87-22" name="__codelineno-87-22" href="#__codelineno-87-22"></a>serviceaccount <span class="s2">&quot;bookinfo-productpage&quot;</span> deleted
<a id="__codelineno-87-23" name="__codelineno-87-23" href="#__codelineno-87-23"></a>deployment.apps <span class="s2">&quot;productpage-v1&quot;</span> deleted
<a id="__codelineno-87-24" name="__codelineno-87-24" href="#__codelineno-87-24"></a>Application cleanup successful
</code></pre></div>
<p>Now let's create istio-system namespace again</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>kubectl create ns istio-system
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>namespace/istio-system created
</code></pre></div>
<p>Then create a secret to include all these certificates</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="nb">cd</span> ca-certs/localcluster/
<a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a>kubectl create secret generic cacerts -n istio-system <span class="se">\</span>
<a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>  --from-file<span class="o">=</span>ca-cert.pem <span class="se">\</span>
<a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a>  --from-file<span class="o">=</span>ca-key.pem <span class="se">\</span>
<a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a>  --from-file<span class="o">=</span>root-cert.pem <span class="se">\</span>
<a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a>  --from-file<span class="o">=</span>cert-chain.pem
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>secret/cacerts created
</code></pre></div>
<p>Here, we'll install Istio back again, so that Istio certificate authority will read the certificates and key from the secret mount files.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>istioctl install --set <span class="nv">profile</span><span class="o">=</span>demo
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>
</code></pre></div>
<p>We can also get our Kiali, Grafana, Prometheus all back</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="nb">cd</span> ../../
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>kubectl apply -f samples/addons
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>serviceaccount/grafana created
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a>configmap/grafana created
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>service/grafana created
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a>deployment.apps/grafana created
<a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a>configmap/istio-grafana-dashboards created
<a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a>configmap/istio-services-grafana-dashboards created
<a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a>deployment.apps/jaeger created
<a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a>service/tracing created
<a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a>service/zipkin created
<a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a>service/jaeger-collector created
<a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a>serviceaccount/kiali created
<a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a>configmap/kiali created
<a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a>clusterrole.rbac.authorization.k8s.io/kiali-viewer created
<a id="__codelineno-95-14" name="__codelineno-95-14" href="#__codelineno-95-14"></a>clusterrole.rbac.authorization.k8s.io/kiali created
<a id="__codelineno-95-15" name="__codelineno-95-15" href="#__codelineno-95-15"></a>clusterrolebinding.rbac.authorization.k8s.io/kiali created
<a id="__codelineno-95-16" name="__codelineno-95-16" href="#__codelineno-95-16"></a>role.rbac.authorization.k8s.io/kiali-controlplane created
<a id="__codelineno-95-17" name="__codelineno-95-17" href="#__codelineno-95-17"></a>rolebinding.rbac.authorization.k8s.io/kiali-controlplane created
<a id="__codelineno-95-18" name="__codelineno-95-18" href="#__codelineno-95-18"></a>service/kiali created
<a id="__codelineno-95-19" name="__codelineno-95-19" href="#__codelineno-95-19"></a>deployment.apps/kiali created
<a id="__codelineno-95-20" name="__codelineno-95-20" href="#__codelineno-95-20"></a>serviceaccount/prometheus created
<a id="__codelineno-95-21" name="__codelineno-95-21" href="#__codelineno-95-21"></a>configmap/prometheus created
<a id="__codelineno-95-22" name="__codelineno-95-22" href="#__codelineno-95-22"></a>clusterrole.rbac.authorization.k8s.io/prometheus created
<a id="__codelineno-95-23" name="__codelineno-95-23" href="#__codelineno-95-23"></a>clusterrolebinding.rbac.authorization.k8s.io/prometheus created
<a id="__codelineno-95-24" name="__codelineno-95-24" href="#__codelineno-95-24"></a>service/prometheus created
<a id="__codelineno-95-25" name="__codelineno-95-25" href="#__codelineno-95-25"></a>deployment.apps/prometheus created
</code></pre></div>
<p>Deploy the sample booking deployment</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>kubectl apply -f istio-1.14.1/samples/bookinfo/platform/kube/bookinfo.yaml
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>service/details created
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a>serviceaccount/bookinfo-details created
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a>deployment.apps/details-v1 created
<a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a>service/ratings created
<a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a>serviceaccount/bookinfo-ratings created
<a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a>deployment.apps/ratings-v1 created
<a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a>service/reviews created
<a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a>serviceaccount/bookinfo-reviews created
<a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a>deployment.apps/reviews-v1 created
<a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a>deployment.apps/reviews-v2 created
<a id="__codelineno-97-11" name="__codelineno-97-11" href="#__codelineno-97-11"></a>deployment.apps/reviews-v3 created
<a id="__codelineno-97-12" name="__codelineno-97-12" href="#__codelineno-97-12"></a>service/productpage created
<a id="__codelineno-97-13" name="__codelineno-97-13" href="#__codelineno-97-13"></a>serviceaccount/bookinfo-productpage created
<a id="__codelineno-97-14" name="__codelineno-97-14" href="#__codelineno-97-14"></a>deployment.apps/productpage-v1 created
</code></pre></div>
<p>Create a Gateway and its virtual service</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>gateway.networking.istio.io/bookinfo-gateway created
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>virtualservice.networking.istio.io/bookinfo created
</code></pre></div>
<p>Create destination rules</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>kubectl apply -f samples/bookinfo/networking/destination-rule-all.yaml
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>destinationrule.networking.istio.io/productpage created
<a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a>destinationrule.networking.istio.io/reviews created
<a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a>destinationrule.networking.istio.io/ratings created
<a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a>destinationrule.networking.istio.io/details created
</code></pre></div>
<p>Check/analyze Istio</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>istioctl analyze
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>✔ No validation issues found when analyzing namespace: default
</code></pre></div>
<p>Now, let's deploy a policy for our workloads to only accept mTLS traffic, strict mode here identifies that.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>cat <span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="s">apiVersion: security.istio.io/v1beta1</span>
<a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="s">kind: PeerAuthentication</span>
<a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="s">metadata:</span>
<a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a><span class="s">  name: default</span>
<a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a><span class="s">spec:</span>
<a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a><span class="s">  mtls:</span>
<a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a><span class="s">    mode: STRICT</span>
<a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a><span class="s">EOF</span>
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>peerauthentication.security.istio.io/default created
</code></pre></div>
<p>Now, we will check if the workloads are signed with the exact same certificate that we just plugged in. When we're trying to connect the productpage</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>kubectl <span class="nb">exec</span> <span class="s2">&quot;</span><span class="k">$(</span>kubectl get pod -l <span class="nv">app</span><span class="o">=</span>details -o <span class="nv">jsonpath</span><span class="o">={</span>.items..metadata.name<span class="o">}</span><span class="k">)</span><span class="s2">&quot;</span> -c istio-proxy -- openssl s_client -showcerts -connect productpage:9080 &gt; httpbin-proxy-cert.txt
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="nv">depth</span><span class="o">=</span><span class="m">2</span> <span class="nv">O</span> <span class="o">=</span> Istio, <span class="nv">CN</span> <span class="o">=</span> Root CA
<a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a>verify error:num<span class="o">=</span><span class="m">19</span>:self signed certificate <span class="k">in</span> certificate chain
<a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a>DONE
</code></pre></div>
<p>As the CA certificate used in this example is self-signed, the verify error:num=19:self signed certificate in certificate chain error returned by the <code>openssl</code> command is expected</p>
<p>Now, here in the TXT file we have the certificates and we'll clear the rest of the certificate details with the <code>sed</code> command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>sed -ne <span class="s1">&#39;/-----BEIN CERTIFICATE-----/,/-----END CERTIFICATE-----/p&#39;</span> httpbin-proxy-cert.txt <span class="p">|</span> sed <span class="s1">&#39;s/^\s*//&#39;</span> &gt; certs.pem
</code></pre></div>
<p>Let's check the <code>certs.pem</code> to see the certificates extracted from the traffic between 2 services.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>cat certs.pem
</code></pre></div>
<p>Now, with <code>split</code>, we can split these into 4 different files.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>split -p <span class="s2">&quot;-----BEGIN CERTIFICATE-----&quot;</span> certs.pem proxy-cert-
</code></pre></div>
<p>Now, we will verify if the root certificate is the same as the one we specified.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a>openssl x509 -in ca-certs/localcluster/root-cert.pem -text -noout &gt; /tmp/root-cert.crt.txt
</code></pre></div>
<p>The second command will dump certificate information of the one we just extracted from the traffic itself.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>openssl x509 -in ./proxy-cert-3.pem -text -noout &gt; /tmp/pod-root-cert.crt.txt
</code></pre></div>
<p>Let's check if these match</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a>diff -s /tmp/root-cert.crt.txt /tmp/pod-root-cert.crt.txt
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>Files /tmp/root-cert.crt.txt and /tmp/pod-root-cert.crt.txt are identical
</code></pre></div>
<p>Same to verify the CA certificate is the same</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>openssl x509 -in ca-certs/localcluster/ca-cert.pem -text -noout &gt; /tmp/ca-cert.crt.txt
<a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a>openssl x509 -in ./proxy-cert-2.pem -text -noout &gt; /tmp/pod-cert-chain-ca.crt.txt
<a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a>diff -s /tmp/ca-cert.crt.txt /tmp/pod-cert-chain-ca.crt.txt
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>Files /tmp/ca-cert.crt.txt and /tmp/pod-cert-chain-ca.crt.txt are identical
</code></pre></div>
<p>Let's also verify the certificate chain from the root certificate to the workload certificate.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a>openssl verify -CAfile &lt;<span class="o">(</span>cat ca-certs/localcluster/ca-cert.pem ca-certs/localcluster/root-cert.pem<span class="o">)</span> ./proxy-cert-1.pem
</code></pre></div>
<p>The output is similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a>./proxy-cert-1.pem OK
</code></pre></div>
<h2 id="observability">Observability<a class="headerlink" href="#observability" title="Permanent link">&para;</a></h2>
<p>How to collect and customize telemetry information from our mesh. Istio has advantage in terms of observability because all of the traffic is handled by Envoy proxies in the data plane.
Your service mesh will generate very detailed telemetry information for all service comminications with Istio. Without having to develop a solution you can have observability of services to troubleshoot and optimize the applications.</p>
<ul>
<li><strong>Visualizing Metrics</strong> with Prometheus and Grafana</li>
<li><strong>Distributed Tracing</strong> with Jaeger</li>
<li><strong>Kiali</strong> in Detail</li>
</ul>
<h3 id="visualizing-metrics-with-prometheus-and-grafana">Visualizing Metrics with Prometheus and Grafana<a class="headerlink" href="#visualizing-metrics-with-prometheus-and-grafana" title="Permanent link">&para;</a></h3>
<p>The standard Istio metrics are exported to Prometheus by default. Prometheus is a modern monitoring tool to gather metrics for distributed architechtures and it is used by many applications and the underlying tools to collect and store metrics. By integrating your service mesh data, you will have a nice unified approach to monitoring metrics. Then, as an Istio addon your metrics can be monitored in Grafana, which is an open-source visualization and analytics tool.</p>
<p>Demo the Prometheus dashboard and explore some metrics.</p>
<p>Open the Prometheus dashboard</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a>istioctl dashboard prometheus
</code></pre></div>
<p>Prometheus is not intended for graphical representation of metrics data. Grafana can be used for that. And here we have the Alerts, Graph, and Status tab</p>
<ul>
<li><code>istio_requests_total</code> metric holds the total number of requests that are coming.</li>
<li><code>istio_requests_total{destination_service="productpage.default.svc.cluster.local"}</code></li>
</ul>
<p>Open the Grafana dashboard</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a>istioctl dashboard grafana
</code></pre></div>
<p>In Grafana, you can see Search, Create, Dashboard, Explore, Alerting, and Configuration Menu</p>
<h3 id="distributed-tracing-with-jaeger">Distributed Tracing with Jaeger<a class="headerlink" href="#distributed-tracing-with-jaeger" title="Permanent link">&para;</a></h3>
<p>A way to monitor and understand behavior of services, is to monitor individual requests as a flow through a mesh, which is called distributed tracing. Service dependencies and the sources of latency within the service mesh can be observed by tracing. Istio enables distributed tracing through Envoy proxies and supports Zipkin, Lightstep, Jaeger and Datadog.</p>
<p>Demo Distriuted Tracing with Jaeger</p>
<p>Open the Jaeger dashboard</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a>istioctl dashboard jaeger
</code></pre></div>
<p>In Jaeger, we can filter services by name, by operation name, by some tags and traces, by duration of traces, and the number of results.</p>
<h3 id="kiali-in-more-detail">Kiali in more detail<a class="headerlink" href="#kiali-in-more-detail" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Overview</p>
</li>
<li>
<p>Overview gives us a summary of our mesh, the workloads, and the services. And all these can be broken down by:</p>
<ul>
<li>Health</li>
<li>mTLS status</li>
<li>Namespace Label</li>
</ul>
</li>
<li>
<p>We can also get the Health information for:</p>
<ul>
<li>Apps</li>
<li>Workloads</li>
<li>Services</li>
</ul>
</li>
<li>
<p>Graph</p>
</li>
<li>
<p>Graph will have a very informative and clear visualization of the traffic between our services. The Graph has different versions:</p>
<ul>
<li>App graph</li>
<li>Service graph</li>
<li>Versioned app graph</li>
<li>Worklaod graph</li>
</ul>
</li>
<li>
<p>These versions provide different focus views on our app by grouping accordingly.</p>
</li>
<li>The left bottom part hels us modify the graph view</li>
<li>On the Display, we can add more information and formating from our data plane to the graph.</li>
</ul>
<h3 id="a-quick-note-on-service-mesh-interface">A QUICK NOTE ON SERVICE MESH INTERFACE<a class="headerlink" href="#a-quick-note-on-service-mesh-interface" title="Permanent link">&para;</a></h3>
<p>While Service Mesh technologies are getting more and more polular, Service Mesh vendors keep providing new features. This is both exciting and scary at the same time because while application developers enjoy using these features, they may be locked into a vendor-specific implementation.
So in 2019, Microsoft has announced their onging work on Service Mesh Interface. The main goal was to create an abstraction layer on various types of service meshes implementations, which will create a standard interface, a basic feature set, and community to drive innovation effort on Service Mesh technologies. So developers will not spend a lot of time trying to understand different features that a service mesh offers using this set of functionality, and they will be able to jump in and start using any product.
10 Service Mesh providers so far have implemented the common standards, Istio being on of them. You can find a total list of providers in SMI SPEC in smi-spec.io.
So the Service Mesh Interface will be covering traffic policy, traffic telemetry, and traffic management topics while also providing portability and flexibility. SMI APIs are expected to mature over time and the current capabilities will definitely extend.</p>
<h2 id="whatsnext">Whatsnext<a class="headerlink" href="#whatsnext" title="Permanent link">&para;</a></h2>
<!-- provide a bulleted list of topics (5 maximum) to learn more about the concept. -->

<!-- *[Add-ons]: Resources that extend the functionality of Kubernetes.
*[Admission Controller]: A piece of code that intercepts requests to the Kubernetes API server prior to persistence of the object.
*[Affinity]: In Kubernetes, affinity is a set of rules that give hints to the scheduler about where to place pods.
*[Aggregation Layer]: The aggregation layer lets you install additional Kubernetes-style APIs in your cluster.
*[Annotation]: A key-value pair that is used to attach arbitrary non-identifying metadata to objects.
*[API Group]: A set of related paths in Kubernetes API.
*[API Server]: Also known as:kube-apiserver. The API server is a component of the Kubernetes control plane that exposes the Kubernetes API. The API server is the front end for the Kubernetes control plane.
*[API-initiated eviction]: API-initiated eviction is the process by which you use the Eviction API to create an Eviction object that triggers graceful pod termination.
*[App Container]: Application containers (or app containers) are the containers in a pod that are started after any init containers have completed.
*[Application Architect]: A person responsible for the high-level design of an application.
*[Application Developer]: A person who writes an application that runs in a Kubernetes cluster.
*[Applications]: The layer where various containerized applications run.
*[Approver]: A person who can review and approve Kubernetes code contributions.
*[cAdvisor]: cAdvisor (Container Advisor) provides container users an understanding of the resource usage and performance characteristics of their running containers.
*[Certificate]: A cryptographically secure file used to validate access to the Kubernetes cluster.
*[cgroup]: A group (control group) of Linux processes with optional resource isolation, accounting and limits.
*[CIDR]: CIDR (Classless Inter-Domain Routing) is a notation for describing blocks of IP addresses and is used heavily in various networking configurations.
*[CLA]: (Contributor License Agreement) Terms under which a contributor grants a license to an open source project for their contributions.
*[Cloud Controller Manager]: A Kubernetes control plane component that embeds cloud-specific control logic. The cloud controller manager lets you link your cluster into your cloud provider's API, and separates out the components that interact with that cloud platform from components that only interact with your cluster.
*[Cloud Native Computing Foundation]: The Cloud Native Computing Foundation (CNCF) builds sustainable ecosystems and fosters a community around projects that orchestrate containers as part of a microservices architecture. Kubernetes is a CNCF project.
*[Cloud Provider]: Also known as:Cloud Service Provider. A business or other organization that offers a cloud computing platform.
*[Cluster Architect]: A person who designs infrastructure that involves one or more Kubernetes clusters.
*[Cluster Infrastructure]: The infrastructure layer provides and maintains VMs, networking, security groups and others.
*[Cluster Operations]: The work involved in managing a Kubernetes cluster: managing day-to-day operations, and co-ordinating upgrades.
*[Cluster Operator]: A person who configures, controls, and monitors clusters.
*[Cluster]: A set of worker machines, called nodes, that run containerized applications. Every cluster has at least one worker node.
*[Code Contributor]: A person who develops and contributes code to the Kubernetes open source codebase.
*[ConfigMap]: An API object used to store non-confidential data in key-value pairs. Pods can consume ConfigMaps as environment variables, command-line arguments, or as configuration files in a volume.
*[Container Environment Variables]: Container environment variables are name=value pairs that provide useful information into containers running in a pod
*[Container Lifecycle Hooks]: The lifecycle hooks expose events in the Container management lifecycle and let the user run code when the events occur.
*[Container Network Interface]: Container network interface (CNI) plugins are a type of Network plugin that adheres to the appc/CNI specification.
*[Container Runtime]: The container runtime is the software that is responsible for running containers.
*[Container Runtime Interface]: The container runtime interface (CRI) is an API for container runtimes to integrate with kubelet on a node.
*[Container Storage Interface]: The Container Storage Interface (CSI) defines a standard interface to expose storage systems to containers.
*[Ephemeral Container]: A Container type that you can temporarily run inside a Pod.
*[Init Container]: One or more initialization containers that must run to completion before any app containers run.
*[Container]: A lightweight and portable executable image that contains software and all of its dependencies.
*[containerd]: A container runtime with an emphasis on simplicity, robustness and portability
*[Contributor]: Someone who donates code, documentation, or their time to help the Kubernetes project or community.
*[Control Plane]: The container orchestration layer that exposes the API and interfaces to define, deploy, and manage the lifecycle of containers.
*[Controller]: In Kubernetes, controllers are control loops that watch the state of your cluster, then make or request changes where needed. Each controller tries to move the current cluster state closer to the desired state.
*[CRI-OA]: tool that lets you use OCI container runtimes with Kubernetes CRI.
*[CronJob]: Manages a Job that runs on a periodic schedule.
*[CustomResourceDefinition]: Custom code that defines a resource to add to your Kubernetes API server without building a complete custom server.
*[DaemonSet]: Ensures a copy of a Pod is running across a set of nodes in a cluster.
*[Data Plane]: The layer that provides capacity such as CPU, memory, network, and storage so that the containers can run and connect to a network.
*[Deployment]: An API object that manages a replicated application, typically by running Pods with no local state.
*[Developer]: (disambiguation) May refer to: Application Developer, Code Contributor, or Platform Developer.
*[Device Plugin]: Device plugins run on worker Nodes and provide Pods with access to resources, such as local hardware, that require vendor-specific initialization or setup steps.
*[Disruption]: Disruptions are events that lead to one or more Pods going out of service. A disruption has consequences for workload resources, such as Deployment, that rely on the affected Pods.
*[Docker]: Docker (specifically, Docker Engine) is a software technology providing operating-system-level virtualization also known as containers.
*[Dockershim]: The dockershim is a component of Kubernetes version 1.23 and earlier. It allows the kubelet to communicate with Docker Engine.
*[Horizontal Pod Autoscaler]: Also known as:HPA. An API resource that automatically scales the number of Pod replicas based on targeted CPU utilization or custom metric targets.
*[Downstream]: (disambiguation) May refer to: code in the Kubernetes ecosystem that depends upon the core Kubernetes codebase or a forked repo.
*[Dynamic Volume Provisioning]: Allows users to request automatic creation of storage Volumes.
*[Endpoints]: Endpoints track the IP addresses of Pods with matching selectors.
*[EndpointSlice]: A way to group network endpoints together with Kubernetes resources.
*[etcd]: Consistent and highly-available key value store used as Kubernetes' backing store for all cluster data.
*[Event]: Each Event is a report of an event somewhere in the cluster. It generally denotes some state change in the system.
*[Eviction]: Eviction is the process of terminating one or more Pods on Nodes.
*[Extensions]: Extensions are software components that extend and deeply integrate with Kubernetes to support new types of hardware.
*[Finalizer]: Finalizers are namespaced keys that tell Kubernetes to wait until specific conditions are met before it fully deletes resources marked for deletion. Finalizers alert controllers to clean up resources the deleted object owned.
*[FlexVolume]: FlexVolume is a deprecated interface for creating out-of-tree volume plugins. The Container Storage Interface is a newer interface that addresses several problems with FlexVolume.
*[Garbage Collection]: Garbage collection is a collective term for the various mechanisms Kubernetes uses to clean up cluster resources.
*[Helm Chart]: A package of pre-configured Kubernetes resources that can be managed with the Helm tool.
*[HostAliases]: A HostAliases is a mapping between the IP address and hostname to be injected into a Pod's hosts file.
*[Image]: Stored instance of a Container that holds a set of software needed to run an application.
*[Ingress]: An API object that manages external access to the services in a cluster, typically HTTP.
*[Istio]: An open platform (not Kubernetes-specific) that provides a uniform way to integrate microservices, manage traffic flow, enforce policies, and aggregate telemetry data.
*[Job]: A finite or batch task that runs to completion.
*[Kops]: A CLI tool that helps you create, destroy, upgrade and maintain production-grade, highly available, Kubernetes clusters.
*[kube-controller-manager]: Control plane component that runs controller processes.
*[kube-proxy]: kube-proxy is a network proxy that runs on each node in your cluster, implementing part of the Kubernetes Service concept.
*[kube-scheduler]: Control plane component that watches for newly created Pods with no assigned node, and selects a node for them to run on.
*[Kubeadm]: A tool for quickly installing Kubernetes and setting up a secure cluster.
*[Kubectl]: Also known as:kubectl. Command line tool for communicating with a Kubernetes cluster's control plane, using the Kubernetes API.
*[Kubelet]: An agent that runs on each node in the cluster. It makes sure that containers are running in a Pod.
*[Kubernetes API]: The application that serves Kubernetes functionality through a RESTful interface and stores the state of the cluster.
*[Label]: Tags objects with identifying attributes that are meaningful and relevant to users.
*[LimitRange]: Provides constraints to limit resource consumption per Containers or Pods in a namespace.
*[Logging]: Logs are the list of events that are logged by cluster or application.
*[Managed Service]: A software offering maintained by a third-party provider.
*[Manifest]: Specification of a Kubernetes API object in JSON or YAML format.
*[Master]: Legacy term, used as synonym for nodes hosting the control plane.
*[Member]: A continuously active contributor in the K8s community.
*[Minikube]: A tool for running Kubernetes locally.
*[Mirror Pod]: A pod object that a kubelet uses to represent a static pod
*[Name]: A client-provided string that refers to an object in a resource URL, such as /api/v1/pods/some-name.
*[Namespace]: An abstraction used by Kubernetes to support isolation of groups of resources within a single cluster.
*[Network Policy]: A specification of how groups of Pods are allowed to communicate with each other and with other network endpoints.
*[Node-pressure eviction]: Also known as:kubelet eviction. Node-pressure eviction is the process by which the kubelet proactively terminates pods to reclaim resources on nodes.
*[Node]: A node is a worker machine in Kubernetes.
*[Object]: An entity in the Kubernetes system. The Kubernetes API uses these entities to represent the state of your cluster.
*[Operator Pattern]: The operator pattern is a system design that links a Controller to one or more custom resources.
*[Persistent Volume Claim]: Claims storage resources defined in a PersistentVolume so that it can be mounted as a volume in a container.
*[Persistent Volume]: An API object that represents a piece of storage in the cluster. Available as a general, pluggable resource that persists beyond the lifecycle of any individual Pod.
*[Platform Developer]: A person who customizes the Kubernetes platform to fit the needs of their project.
*[Pod Disruption Budget]: Also known as:PDB. A Pod Disruption Budget allows an application owner to create an object for a replicated application, that ensures a certain number or percentage of Pods with an assigned label will not be voluntarily evicted at any point in time.
*[Pod Disruption]: Pod disruption is the process by which Pods on Nodes are terminated either voluntarily or involuntarily.
*[Pod Lifecycle]: The sequence of states through which a Pod passes during its lifetime.
*[Pod Priority]: Pod Priority indicates the importance of a Pod relative to other Pods.
*[Pod Security Policy]: Enables fine-grained authorization of Pod creation and updates.
*[Static Pod]: A pod managed directly by the kubelet daemon on a specific node,
*[Pod]: The smallest and simplest Kubernetes object. A Pod represents a set of running containers on your cluster.
*[Preemption]: Preemption logic in Kubernetes helps a pending Pod to find a suitable Node by evicting low priority Pods existing on that Node.
*[Proxy]: In computing, a proxy is a server that acts as an intermediary for a remote service.
*[QoS Class]: QoS Class (Quality of Service Class) provides a way for Kubernetes to classify Pods within the cluster into several classes and make decisions about scheduling and eviction.
*[Quantity]: A whole-number representation of small or large numbers using SI suffixes.
*[RBAC]: (Role-Based Access Control) Manages authorization decisions, allowing admins to dynamically configure access policies through the Kubernetes API.
*[ReplicaSet]: A ReplicaSet (aims to) maintain a set of replica Pods running at any given time.
*[ReplicationController]: A workload resource that manages a replicated application, ensuring that a specific number of instances of a Pod are running.
*[Resource Quotas]: Provides constraints that limit aggregate resource consumption per Namespace.
*[Reviewer]: A person who reviews code for quality and correctness on some part of the project.
*[Secret]: Stores sensitive information, such as passwords, OAuth tokens, and ssh keys.
*[Security Context]: The securityContext field defines privilege and access control settings for a Pod or container.
*[Selector]: Allows users to filter a list of resources based on labels.
*[Service Broker]: An endpoint for a set of Managed Services offered and maintained by a third-party.
*[Service Catalog]: An extension API that enables applications running in Kubernetes clusters to easily use external managed software offerings, such as a datastore service offered by a cloud provider.
*[Service]: An abstract way to expose an application running on a set of Pods as a network service.
*[ServiceAccount]: Provides an identity for processes that run in a Pod.
*[Shuffle-sharding]: A technique for assigning requests to queues that provides better isolation than hashing modulo the number of queues.
*[SIG]: (special interest group) Community members who collectively manage an ongoing piece or aspect of the larger Kubernetes open source project.
*[StatefulSet]: Manages the deployment and scaling of a set of Pods, and provides guarantees about the ordering and uniqueness of these Pods.
*[Storage Class]: A StorageClass provides a way for administrators to describe different available storage types.
*[sysctl]: sysctl is a semi-standardized interface for reading or changing the attributes of the running Unix kernel.
*[Taint]: A core object consisting of three required properties: key, value, and effect. Taints prevent the scheduling of Pods on nodes or node groups.
*[Toleration]: A core object consisting of three required properties: key, value, and effect. Tolerations enable the scheduling of pods on nodes or node groups that have matching taints.
*[UID]: A Kubernetes systems-generated string to uniquely identify objects.
*[Upstream]: (disambiguation) May refer to: core Kubernetes or the source repo from which a repo was forked.
*[user namespace]: A kernel feature to emulate root. Used for "rootless containers".
*[Volume Plugin]: A Volume Plugin enables integration of storage within a Pod.
*[Volume]: A directory containing data, accessible to the containers in a Pod.
*[WG]: (working group) Facilitates the discussion and/or implementation of a short-lived, narrow, or decoupled project for a committee, SIG, or cross-SIG effort.
*[Workload]: A workload is an application running on Kubernetes. -->

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Nhâm Chấn Vĩ

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["search.suggest", "search.highlight", "search.share", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.indexes", "toc.integrate", "navigation.top", "content.code.annotate", "content.tabs.link"], "search": "../../../../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.3a4b43e5.min.js"></script>
      
        <script src="../../../../../javascripts/shortcuts.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../../../../javascripts/tablesort.js"></script>
      
    
  </body>
</html>